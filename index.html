<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Degrees of Help</title>
  <link href="https://fonts.googleapis.com/css2?family=EB+Garamond:ital,wght@0,400;0,500;0,600;1,400&family=JetBrains+Mono:wght@400;500&display=swap" rel="stylesheet">
  <style>
    * { box-sizing: border-box; margin: 0; padding: 0; }
    
    body {
      min-height: 100vh;
      background-color: #0a0a0f;
      color: #e8e0d5;
      font-family: "EB Garamond", Georgia, serif;
      padding: 40px 20px;
      line-height: 1.5;
    }
    
    .container {
      max-width: 1100px;
      margin: 0 auto;
    }
    
    header {
      text-align: center;
      margin-bottom: 50px;
    }
    
    h1 {
      font-size: clamp(32px, 5vw, 48px);
      font-weight: 500;
      letter-spacing: -0.02em;
      margin-bottom: 16px;
      background: linear-gradient(135deg, #ffe4b5 0%, #ffb060 50%, #ff8040 100%);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
    }
    
    .subtitle {
      font-size: 18px;
      color: rgba(232, 224, 213, 0.6);
      font-style: italic;
      max-width: 600px;
      margin: 0 auto;
      line-height: 1.6;
    }
    
    .main-grid {
      display: grid;
      grid-template-columns: minmax(300px, 400px) 1fr;
      gap: 40px;
      align-items: start;
    }
    
    @media (max-width: 800px) {
      .main-grid {
        grid-template-columns: 1fr;
      }
    }
    
    .control-section {
      background: rgba(255, 255, 255, 0.02);
      border: 1px solid rgba(255, 180, 100, 0.1);
      border-radius: 8px;
      padding: 20px;
      margin-bottom: 16px;
    }
    
    .control-label {
      display: block;
      font-size: 14px;
      color: rgba(255, 180, 100, 0.8);
      margin-bottom: 12px;
      font-family: "JetBrains Mono", monospace;
    }
    
    .control-label strong {
      color: #ffb060;
      font-size: 18px;
    }
    
    input[type="range"] {
      -webkit-appearance: none;
      appearance: none;
      background: transparent;
      cursor: pointer;
      width: 100%;
    }
    
    input[type="range"]::-webkit-slider-track {
      background: rgba(255, 180, 100, 0.2);
      height: 4px;
      border-radius: 2px;
    }
    
    input[type="range"]::-webkit-slider-thumb {
      -webkit-appearance: none;
      appearance: none;
      width: 16px;
      height: 16px;
      border-radius: 50%;
      background: #ffb060;
      margin-top: -6px;
      box-shadow: 0 0 10px rgba(255, 180, 100, 0.5);
    }
    
    input[type="range"]::-moz-range-track {
      background: rgba(255, 180, 100, 0.2);
      height: 4px;
      border-radius: 2px;
    }
    
    input[type="range"]::-moz-range-thumb {
      width: 16px;
      height: 16px;
      border-radius: 50%;
      background: #ffb060;
      border: none;
      box-shadow: 0 0 10px rgba(255, 180, 100, 0.5);
    }
    
    .range-labels {
      display: flex;
      justify-content: space-between;
      font-size: 11px;
      color: rgba(255, 180, 100, 0.4);
      margin-top: 4px;
      font-family: "JetBrains Mono", monospace;
    }
    
    .control-hint {
      font-size: 12px;
      color: rgba(232, 224, 213, 0.4);
      margin-top: 8px;
      line-height: 1.5;
    }
    
    .button-row {
      display: flex;
      gap: 12px;
      margin-top: 24px;
      flex-wrap: wrap;
    }
    
    button {
      font-family: 'JetBrains Mono', monospace;
      font-size: 13px;
      padding: 12px 24px;
      border: 1px solid rgba(255, 180, 100, 0.3);
      background: rgba(255, 180, 100, 0.1);
      color: #ffb060;
      border-radius: 4px;
      cursor: pointer;
      transition: all 0.2s ease;
    }
    
    button:hover {
      background: rgba(255, 180, 100, 0.2);
      border-color: rgba(255, 180, 100, 0.5);
      box-shadow: 0 0 20px rgba(255, 180, 100, 0.2);
    }
    
    #canvas {
      width: 100%;
      height: auto;
      border-radius: 8px;
      border: 1px solid rgba(255, 180, 100, 0.1);
    }
    
    .stats-row {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
      gap: 16px;
      margin-top: 40px;
    }
    
    .stat-card {
      background: linear-gradient(135deg, rgba(255, 180, 100, 0.08) 0%, rgba(255, 140, 60, 0.03) 100%);
      border: 1px solid rgba(255, 180, 100, 0.15);
      border-radius: 8px;
      padding: 20px;
      text-align: center;
    }
    
    .stat-label {
      font-size: 11px;
      text-transform: uppercase;
      letter-spacing: 0.1em;
      color: rgba(255, 180, 100, 0.6);
      margin-bottom: 8px;
      font-family: "JetBrains Mono", monospace;
    }
    
    .stat-value {
      font-size: 36px;
      font-weight: 600;
      color: #ffb060;
    }
    
    .stat-value.primary { color: #ffe4b5; }
    .stat-value.success { color: #90ee90; }
    
    .progress-bar {
      height: 8px;
      background: rgba(255, 180, 100, 0.1);
      border-radius: 4px;
      overflow: hidden;
      margin-top: 20px;
    }
    
    .progress-fill {
      height: 100%;
      background: linear-gradient(90deg, #ff8040, #ffb060);
      border-radius: 4px;
      transition: width 0.5s ease;
      width: 0%;
    }
    
    .formula {
      font-family: 'JetBrains Mono', monospace;
      font-size: 13px;
      color: rgba(255, 180, 100, 0.7);
      background: rgba(0, 0, 0, 0.3);
      padding: 12px 16px;
      border-radius: 4px;
      margin-top: 30px;
      text-align: center;
    }
    
    .formula .arrow {
      margin: 0 20px;
      opacity: 0.6;
    }
    
    .insight {
      margin-top: 40px;
      padding: 30px;
      background: rgba(255, 180, 100, 0.03);
      border-left: 3px solid rgba(255, 180, 100, 0.3);
      border-radius: 0 8px 8px 0;
    }
    
    .insight p {
      font-size: 18px;
      line-height: 1.8;
      color: rgba(232, 224, 213, 0.85);
      margin: 0;
    }
    
    .insight strong {
      color: #ffb060;
    }
    
    footer {
      margin-top: 60px;
      text-align: center;
      font-size: 13px;
      color: rgba(232, 224, 213, 0.3);
      font-family: "JetBrains Mono", monospace;
    }
  </style>
</head>
<body>
  <div class="container">
    <header>
      <h1>Degrees of Help</h1>
      <p class="subtitle">
        If we treated kindness like a protocol instead of a vibe,<br>
        how many hops away from "everyone's been helped" are we?
      </p>
    </header>
    
    <div class="main-grid">
      <div class="controls">
        <div class="control-section">
          <label class="control-label">
            People helped per person: <strong id="k-value">5</strong>
          </label>
          <input type="range" id="k-slider" min="2" max="20" value="5">
          <div class="range-labels">
            <span>2</span>
            <span>20</span>
          </div>
        </div>
        
        <div class="control-section">
          <label class="control-label">
            Network overlap: <strong id="overlap-value">0%</strong>
          </label>
          <input type="range" id="overlap-slider" min="0" max="80" value="0">
          <p class="control-hint">How much people cluster—helping friends of friends</p>
        </div>
        
        <div class="control-section">
          <label class="control-label">
            Isolation factor: <strong id="isolation-value">0%</strong>
          </label>
          <input type="range" id="isolation-slider" min="0" max="50" value="0">
          <p class="control-hint">Unreachable nodes—remote, isolated, blocked from help</p>
        </div>
        
        <div class="button-row">
          <button id="play-btn">▶ Play</button>
          <button id="reset-btn">↺ Reset</button>
          <button id="step-btn">+1 Wave</button>
        </div>
      </div>
      
      <div class="visualization">
        <canvas id="canvas" width="500" height="400"></canvas>
      </div>
    </div>
    
    <div class="stats-row">
      <div class="stat-card">
        <div class="stat-label">Current Wave</div>
        <div class="stat-value" id="current-wave">0</div>
      </div>
      <div class="stat-card">
        <div class="stat-label">Waves Needed</div>
        <div class="stat-value primary" id="waves-needed">14</div>
      </div>
      <div class="stat-card">
        <div class="stat-label">People Helped</div>
        <div class="stat-value" id="people-helped">1</div>
      </div>
      <div class="stat-card">
        <div class="stat-label">Coverage</div>
        <div class="stat-value" id="coverage">0%</div>
      </div>
    </div>
    
    <div class="progress-bar">
      <div class="progress-fill" id="progress-fill"></div>
    </div>
    
    <div class="formula">
      H(t) = Σ k<sup>i</sup> for i=0 to t ≈ (k<sup>t+1</sup> - 1) / (k - 1)
      <span class="arrow">→</span>
      t ≈ log<sub id="formula-k">5</sub>(8×10<sup>9</sup>) ≈ <strong id="formula-waves">14</strong> waves
    </div>
    
    <div class="insight">
      <p id="insight-text">
        <strong>The math says:</strong> In an ideal world, only 14 layers of "I was helped, now I help 5 more" covers all of humanity.
        <br><br>
        <strong>The ethics say:</strong> The bottleneck isn't math—it's will, structure, and access.
      </p>
    </div>
    
    <footer>
      Moral epidemiology · Degrees of separation → Degrees of help
    </footer>
  </div>

  <script>
    const POPULATION = 8e9;
    
    // State
    let k = 5;
    let overlap = 0;
    let isolation = 0;
    let currentWave = 0;
    let isPlaying = false;
    let playInterval = null;
    let nodes = [];
    
    // DOM elements
    const canvas = document.getElementById('canvas');
    const ctx = canvas.getContext('2d');
    const kSlider = document.getElementById('k-slider');
    const overlapSlider = document.getElementById('overlap-slider');
    const isolationSlider = document.getElementById('isolation-slider');
    const playBtn = document.getElementById('play-btn');
    const resetBtn = document.getElementById('reset-btn');
    const stepBtn = document.getElementById('step-btn');
    
    // Calculate waves needed
    function calcWavesNeeded() {
      let t = 0;
      let helped = 1;
      const effectiveK = k * (1 - overlap * 0.5);
      const reachable = POPULATION * (1 - isolation);
      while (helped < reachable && t < 100) {
        helped += Math.pow(effectiveK, t + 1);
        t++;
      }
      return t;
    }
    
    // Calculate helped at wave
    function calcHelpedAtWave(wave) {
      if (wave === 0) return 1;
      const effectiveK = k * (1 - overlap * 0.5);
      let total = 0;
      for (let i = 0; i <= wave; i++) {
        total += Math.pow(effectiveK, i);
      }
      return Math.min(total, POPULATION * (1 - isolation));
    }
    
    // Format large numbers
    function formatNumber(n) {
      if (n >= 1e9) return (n / 1e9).toFixed(2) + 'B';
      if (n >= 1e6) return (n / 1e6).toFixed(2) + 'M';
      if (n >= 1e3) return (n / 1e3).toFixed(1) + 'K';
      return Math.floor(n).toString();
    }
    
    // Initialize nodes for visualization
    function initNodes() {
      nodes = [];
      const maxNodes = 500;
      const centerX = canvas.width / 2;
      const centerY = canvas.height / 2;
      
      nodes.push({ x: centerX, y: centerY, wave: 0 });
      
      for (let wave = 1; wave <= 6; wave++) {
        const nodesInWave = Math.min(Math.pow(k, wave), maxNodes - nodes.length);
        const radius = wave * 55;
        
        for (let i = 0; i < nodesInWave && nodes.length < maxNodes; i++) {
          const angle = (i / nodesInWave) * Math.PI * 2 + (wave * 0.3);
          const jitter = (Math.random() - 0.5) * 20;
          const x = centerX + Math.cos(angle) * (radius + jitter);
          const y = centerY + Math.sin(angle) * (radius + jitter);
          
          const parentWaveNodes = nodes.filter(n => n.wave === wave - 1);
          const parentIndex = nodes.indexOf(parentWaveNodes[i % parentWaveNodes.length]);
          
          nodes.push({ x, y, wave, parent: parentIndex });
        }
      }
    }
    
    // Draw visualization
    function draw() {
      const width = canvas.width;
      const height = canvas.height;
      const centerX = width / 2;
      const centerY = height / 2;
      
      // Clear
      ctx.fillStyle = '#0a0a0f';
      ctx.fillRect(0, 0, width, height);
      
      // Grid
      ctx.strokeStyle = 'rgba(255, 180, 100, 0.03)';
      ctx.lineWidth = 1;
      for (let i = 0; i < width; i += 40) {
        ctx.beginPath();
        ctx.moveTo(i, 0);
        ctx.lineTo(i, height);
        ctx.stroke();
      }
      for (let i = 0; i < height; i += 40) {
        ctx.beginPath();
        ctx.moveTo(0, i);
        ctx.lineTo(width, i);
        ctx.stroke();
      }
      
      // Connections
      nodes.forEach((node, idx) => {
        if (node.parent !== undefined && node.wave <= currentWave) {
          const parent = nodes[node.parent];
          const progress = Math.min(1, (currentWave - node.wave + 1));
          
          ctx.beginPath();
          ctx.moveTo(parent.x, parent.y);
          ctx.lineTo(
            parent.x + (node.x - parent.x) * progress,
            parent.y + (node.y - parent.y) * progress
          );
          
          const alpha = node.wave <= currentWave ? 0.3 : 0.05;
          ctx.strokeStyle = `rgba(255, 180, 100, ${alpha})`;
          ctx.lineWidth = 1;
          ctx.stroke();
        }
      });
      
      // Nodes
      nodes.forEach((node, idx) => {
        const isActive = node.wave <= currentWave;
        const isCurrentWave = node.wave === currentWave;
        
        if (isActive) {
          const gradient = ctx.createRadialGradient(
            node.x, node.y, 0,
            node.x, node.y, isCurrentWave ? 25 : 15
          );
          
          if (node.wave === 0) {
            gradient.addColorStop(0, 'rgba(255, 220, 150, 0.8)');
            gradient.addColorStop(0.5, 'rgba(255, 180, 100, 0.3)');
            gradient.addColorStop(1, 'rgba(255, 140, 50, 0)');
          } else {
            const intensity = isCurrentWave ? 0.6 : 0.3;
            gradient.addColorStop(0, `rgba(255, 200, 130, ${intensity})`);
            gradient.addColorStop(0.5, `rgba(255, 160, 80, ${intensity * 0.5})`);
            gradient.addColorStop(1, 'rgba(255, 120, 50, 0)');
          }
          
          ctx.beginPath();
          ctx.arc(node.x, node.y, isCurrentWave ? 25 : 15, 0, Math.PI * 2);
          ctx.fillStyle = gradient;
          ctx.fill();
        }
        
        ctx.beginPath();
        const size = node.wave === 0 ? 6 : (isCurrentWave ? 4 : 3);
        ctx.arc(node.x, node.y, size, 0, Math.PI * 2);
        ctx.fillStyle = isActive ? (node.wave === 0 ? '#ffe4b5' : '#ffb060') : 'rgba(100, 80, 60, 0.3)';
        ctx.fill();
      });
      
      // Wave rings
      for (let i = 1; i <= currentWave && i <= 6; i++) {
        ctx.beginPath();
        ctx.arc(centerX, centerY, i * 55, 0, Math.PI * 2);
        ctx.strokeStyle = `rgba(255, 180, 100, ${0.1 - i * 0.01})`;
        ctx.lineWidth = 1;
        ctx.stroke();
      }
    }
    
    // Update UI
    function updateUI() {
      const wavesNeeded = calcWavesNeeded();
      const helped = calcHelpedAtWave(currentWave);
      const percent = (helped / POPULATION) * 100;
      
      document.getElementById('k-value').textContent = k;
      document.getElementById('overlap-value').textContent = Math.round(overlap * 100) + '%';
      document.getElementById('isolation-value').textContent = Math.round(isolation * 100) + '%';
      document.getElementById('current-wave').textContent = currentWave;
      document.getElementById('waves-needed').textContent = wavesNeeded;
      document.getElementById('people-helped').textContent = formatNumber(helped);
      
      const coverageEl = document.getElementById('coverage');
      coverageEl.textContent = percent >= 100 ? '100%' : percent.toFixed(percent < 1 ? 6 : 2) + '%';
      coverageEl.className = 'stat-value' + (percent >= 100 ? ' success' : '');
      
      document.getElementById('progress-fill').style.width = Math.min(percent, 100) + '%';
      document.getElementById('formula-k').textContent = k;
      document.getElementById('formula-waves').textContent = wavesNeeded;
      
      const layerText = k === 2 ? 'just 33 layers' : wavesNeeded <= 15 ? `only ${wavesNeeded} layers` : `${wavesNeeded} layers`;
      document.getElementById('insight-text').innerHTML = `
        <strong>The math says:</strong> In an ideal world, ${layerText} of "I was helped, now I help ${k} more" covers all of humanity.
        <br><br>
        <strong>The ethics say:</strong> The bottleneck isn't math—it's will, structure, and access.
      `;
      
      draw();
    }
    
    // Reset
    function reset() {
      currentWave = 0;
      isPlaying = false;
      playBtn.textContent = '▶ Play';
      if (playInterval) {
        clearInterval(playInterval);
        playInterval = null;
      }
      initNodes();
      updateUI();
    }
    
    // Play/Pause
    function togglePlay() {
      isPlaying = !isPlaying;
      playBtn.textContent = isPlaying ? '⏸ Pause' : '▶ Play';
      
      if (isPlaying) {
        const wavesNeeded = calcWavesNeeded();
        playInterval = setInterval(() => {
          if (currentWave < wavesNeeded) {
            currentWave++;
            updateUI();
          } else {
            isPlaying = false;
            playBtn.textContent = '▶ Play';
            clearInterval(playInterval);
            playInterval = null;
          }
        }, 600);
      } else if (playInterval) {
        clearInterval(playInterval);
        playInterval = null;
      }
    }
    
    // Step
    function step() {
      const wavesNeeded = calcWavesNeeded();
      if (currentWave < wavesNeeded) {
        currentWave++;
        updateUI();
      }
    }
    
    // Event listeners
    kSlider.addEventListener('input', (e) => {
      k = Number(e.target.value);
      reset();
    });
    
    overlapSlider.addEventListener('input', (e) => {
      overlap = Number(e.target.value) / 100;
      reset();
    });
    
    isolationSlider.addEventListener('input', (e) => {
      isolation = Number(e.target.value) / 100;
      reset();
    });
    
    playBtn.addEventListener('click', togglePlay);
    resetBtn.addEventListener('click', reset);
    stepBtn.addEventListener('click', step);
    
    // Initialize
    initNodes();
    updateUI();
  </script>
</body>
</html>
